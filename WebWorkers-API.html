<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="description" content="yes-xodnd의 기술 블로그입니다."/><meta name="keywords" content="blog, frontend, javascript, css, html"/><script src="https://kit.fontawesome.com/0896a76907.js" crossorigin="anonymous"></script><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-201f5cd97deb6faaf31b.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e3de07479da4f2477dea.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.bf8cc4fd2753f92c2ca2.js" as="script"/><link rel="preload" href="/_next/static/chunks/2dd8024639213757075864c624e37c2da904a9c5.66371825a15182f8fdc5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7f1cf177eb808772c597.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/%5Bslug%5D-07e92fca6c260976decf.js" as="script"/><style data-styled="" data-styled-version="5.2.1">@media (max-width:768px){:root{font-size:12px;}}/*!sc*/
body{margin:auto;padding:0;box-sizing:border-box;}/*!sc*/
a{color:black;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
a:visited{color:inherit;}/*!sc*/
a:hover{color:lightseagreen;}/*!sc*/
data-styled.g1[id="sc-global-ccdtUX1"]{content:"sc-global-ccdtUX1,"}/*!sc*/
.eHAsYS{padding:2rem;border-top:1px solid black;color:grey;text-align:center;font-size:0.8rem;}/*!sc*/
data-styled.g2[id="Footer__Container-qhytvz-0"]{content:"eHAsYS,"}/*!sc*/
.bUsZOM{margin:auto;max-width:1024px;}/*!sc*/
.bUsZOM i{margin-right:0.5rem;}/*!sc*/
.bUsZOM div{margin-top:0.5rem;}/*!sc*/
data-styled.g3[id="Footer__Content-qhytvz-1"]{content:"bUsZOM,"}/*!sc*/
.ehWqJ{padding:1rem;background:white;border-bottom:1px solid black;}/*!sc*/
data-styled.g4[id="Header__Container-sc-1isb4n6-0"]{content:"ehWqJ,"}/*!sc*/
.katqRq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:auto;max-width:1024px;}/*!sc*/
data-styled.g5[id="Header__Content-sc-1isb4n6-1"]{content:"katqRq,"}/*!sc*/
.jJNFhh h1{font-size:1.6rem;margin:0;}/*!sc*/
.jJNFhh p{margin:0;color:grey;}/*!sc*/
data-styled.g6[id="Header__TitleContainer-sc-1isb4n6-2"]{content:"jJNFhh,"}/*!sc*/
.ctiUtj{margin:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:0.5rem;list-style:none;}/*!sc*/
@media screen and (min-width:768px){.ctiUtj{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}/*!sc*/
data-styled.g7[id="Header__LinkList-sc-1isb4n6-3"]{content:"ctiUtj,"}/*!sc*/
.iOmmEd{padding:0.5rem;border-radius:5px;font-size:0.8rem;font-weight:bolder;}/*!sc*/
.iOmmEd:hover{cursor:pointer;color:lightseagreen;}/*!sc*/
data-styled.g8[id="Header__LinkListItem-sc-1isb4n6-4"]{content:"iOmmEd,"}/*!sc*/
.iKWWFL{position:fixed;right:3rem;bottom:3rem;width:2rem;height:2rem;border-radius:2px;border:1px solid black;background:white;visibility:visible;-webkit-transition:200ms;transition:200ms;}/*!sc*/
.iKWWFL:hover{cursor:pointer;background-color:lightseagreen;}/*!sc*/
data-styled.g9[id="ButtonScrollUp__Button-sc-1ue24uv-0"]{content:"iKWWFL,"}/*!sc*/
.jVKfxq{min-height:100vh;padding:2rem;margin:auto;max-width:768px;}/*!sc*/
data-styled.g24[id="slug__Container-sc-18fakgz-0"]{content:"jVKfxq,"}/*!sc*/
.hafDjr{margin:2rem 0 5rem;text-align:center;}/*!sc*/
data-styled.g25[id="slug__Header-sc-18fakgz-1"]{content:"hafDjr,"}/*!sc*/
.kkWwsO{margin:0 0 1rem;font-size:2rem;word-break:keep-all;}/*!sc*/
data-styled.g26[id="slug__Title-sc-18fakgz-2"]{content:"kkWwsO,"}/*!sc*/
.fjWIAP{font-size:0.8rem;}/*!sc*/
data-styled.g27[id="slug__Date-sc-18fakgz-3"]{content:"fjWIAP,"}/*!sc*/
.gPUQsU{line-height:1.8rem;}/*!sc*/
.gPUQsU a{color:lightseagreen;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.gPUQsU a:hover{-webkit-text-decoration:underline;text-decoration:underline;}/*!sc*/
.gPUQsU a:visited{color:lightseagreen;}/*!sc*/
.gPUQsU img{display:block;width:90%;margin:2rem auto;padding:1rem;border:1px solid rgb(245,245,245);}/*!sc*/
.gPUQsU h2{margin-top:5rem;}/*!sc*/
.gPUQsU h3{margin-top:3rem;}/*!sc*/
.gPUQsU ul{padding-left:1.5rem;}/*!sc*/
.gPUQsU code:not([class]){padding:0.2rem 0.4rem;background-color:rgb(245,245,245);border-radius:3px;}/*!sc*/
.gPUQsU blockquote{margin:0;padding:0.5rem 1.5rem 0.5rem;border-left:3px solid lightseagreen;border-radius:3px;background:rgb(245,245,245);font-size:0.8rem;}/*!sc*/
.gPUQsU code[class*="language-"],.gPUQsU pre[class*="language-"]{color:#000;background:none;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}/*!sc*/
.gPUQsU code[class*="language-"]::-webkit-scrollbar,.gPUQsU pre[class*="language-"]::-webkit-scrollbar{height:3px;}/*!sc*/
.gPUQsU code[class*="language-"]::-webkit-scrollbar-thumb,.gPUQsU pre[class*="language-"]::-webkit-scrollbar-thumb{background-color:#ccc;}/*!sc*/
.gPUQsU pre[class*="language-"]{padding:1em;margin:.5em 0;overflow:auto;}/*!sc*/
.gPUQsU:not(pre) > code[class*="language-"],.gPUQsU pre[class*="language-"]{background:#f9f9f9;}/*!sc*/
.gPUQsU:not(pre) > code[class*="language-"]{padding:.1em;border-radius:.3em;white-space:normal;}/*!sc*/
.gPUQsU .token.comment,.gPUQsU .token.block-comment,.gPUQsU .token.prolog,.gPUQsU .token.doctype,.gPUQsU .token.cdata{color:slategray;}/*!sc*/
.gPUQsU .token.punctuation{color:#999;}/*!sc*/
.gPUQsU .token.tag,.gPUQsU .token.attr-name,.gPUQsU .token.namespace,.gPUQsU .token.deleted{color:#e2777a;}/*!sc*/
.gPUQsU .token.function-name{color:#6196cc;}/*!sc*/
.gPUQsU .token.boolean,.gPUQsU .token.number,.gPUQsU .token.function{color:#ed782b;}/*!sc*/
.gPUQsU .token.property,.gPUQsU .token.class-name,.gPUQsU .token.constant,.gPUQsU .token.symbol{color:#dea702;}/*!sc*/
.gPUQsU .token.selector,.gPUQsU .token.important,.gPUQsU .token.atrule,.gPUQsU .token.keyword,.gPUQsU .token.builtin{color:#bb60bd;}/*!sc*/
.gPUQsU .token.string,.gPUQsU .token.char,.gPUQsU .token.attr-value,.gPUQsU .token.regex,.gPUQsU .token.variable{color:#2bba61;}/*!sc*/
.gPUQsU .token.operator,.gPUQsU .token.entity,.gPUQsU .token.url{color:#67cdcc;}/*!sc*/
.gPUQsU .token.important,.gPUQsU .token.bold{font-weight:bold;}/*!sc*/
.gPUQsU .token.italic{font-style:italic;}/*!sc*/
.gPUQsU .token.entity{cursor:help;}/*!sc*/
.gPUQsU .token.inserted{color:green;}/*!sc*/
data-styled.g28[id="slug__Content-sc-18fakgz-4"]{content:"gPUQsU,"}/*!sc*/
</style></head><body><div id="__next"><header class="Header__Container-sc-1isb4n6-0 ehWqJ"><div class="Header__Content-sc-1isb4n6-1 katqRq"><div class="Header__TitleContainer-sc-1isb4n6-2 jJNFhh"><h1>TAEWOONG PARK.</h1><p>Frontend Devlog</p></div><ul class="Header__LinkList-sc-1isb4n6-3 ctiUtj"><li class="Header__LinkListItem-sc-1isb4n6-4 iOmmEd"><a href="https://github.com/yes-xodnd/" rel="noopener noreferrer" target="_black">GITHUB</a></li><li class="Header__LinkListItem-sc-1isb4n6-4 iOmmEd">E-MAIL</li><li class="Header__LinkListItem-sc-1isb4n6-4 iOmmEd"><a href="https://github.com/yes-xodnd/portfolio/" rel="noopener noreferrer" target="_black">PORTFOLIO</a></li></ul></div></header><main><section class="slug__Container-sc-18fakgz-0 jVKfxq"><div class="slug__Header-sc-18fakgz-1 hafDjr"><h1 class="slug__Title-sc-18fakgz-2 kkWwsO">WebWorkers API</h1><div class="slug__Date-sc-18fakgz-3 fjWIAP">Apr 9, 2021</div></div><article class="slug__Content-sc-18fakgz-4 gPUQsU"><p><a href="https://yes-xodnd.github.io/js_benchmark">자바스크립트 반복문 벤치마크 웹 어플리케이션</a>을 만들면서, 연산 작업이 메인 스레드를 점유하고 애니메이션 업데이트 등 다른 작업을 막는 현상이 발생하였습니다.  <a href="https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API">WebWorkers API</a>를 사용해 이를 해결할 수 있었고, 간단하게 웹 워커에 대해 정리해보았습니다.</p>
<h3>개요</h3>
<p>웹 워커는 메인 스레드와 분리된 백그라운드 스레드에서 스크립트 연산을 실행할 수 있도록 도와주는 Web API 입니다. 단일 스크립트에서만 사용하는 전용 워커(dedicated worker)와 여러 스크립트에서 공유할 수 있는 공유 워커(shared worker)가 있습니다.</p>
<h3>전역 맥락</h3>
<p>워커는 스크립트의 현재 전역 맥락(Window 객체)과 다른 전역 맥락에서 실행됩니다. 전용 워커, 공유워커의 전역 맥락은 각각 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope">DedicatedWorkerGlobalScope </a>객체, <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope">SharedWorkerGlobalScope</a> 객체입니다.</p>
<p>대부분의 코드를 실행할 수 있지만, 다른 전역 맥락을 가지고 있기 때문에 일부 메서드의 실행은 제한됩니다. 대표적으로 DOM 조작이 불가능하며, DOM 트리에 접근해 조작하는 것 뿐 아니라 <code>document.createElement</code>등으로 DOM 트리에 등록되지 않은 요소를 만드는 것도 불가능합니다.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Functions_and_classes_available_to_workers">MDN 문서</a>에서 워커가 사용할 수 있는 메서드를 확인할 수 있습니다.</p>
<h3>워커 생성</h3>
<p>워커는 window.Worker() 생성자를 통해 생성할 수 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>aURL<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><code>aURL</code>은 워커가 실행될 스크립트 파일의 URL로, 별도의 스크립트 전역 맥락(WorkerGlobalScope)를 가지게 됩니다. 일반적으로 파일에 접근하듯이 사용할 수도 있고, 현재 스크립트가 실행중인 도메인과 같은 도메인의 URL을 사용할 수도 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> worker1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> worker2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'https://same-origin.com/somepath/worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><code>options</code>를 이용해 워커의 설정을 변경할 수 있습니다. 사용 가능한 프로퍼티는 다음과 같습니다.</p>
<ul>
<li>type: <code>classic</code> 또는 <code>module</code> 로 지정됩니다. 기본값은 <code>classic</code>이며, <code>module</code>을 사용할 경우 워커 스크립트 파일에서 ES6 <code>import</code>를 사용할 수 있습니다.</li>
<li>name: 전용 워커의 글로벌 스코프를 특정하는 이름을 지정합니다. 디버깅을 위해 사용됩니다.</li>
<li>credentials: 워커를 사용하기 위해 필요한 자격 증명을 지정합니다. <code>omit</code>, <code>same-origin</code>, <code>include</code>를 지정할 수 있습니다. <code>classic</code>  type에서 기본값은 자격 증명이 필요없는 <code>omit</code>입니다.</li>
</ul>
<h3>워커 사용</h3>
<p><code>postMessage</code> 메서드를 이용해 메인 스레드와 워커 스레드가 메세지를 전송하여 통신할 수 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// main thread</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>aMessage<span class="token punctuation">,</span> transferList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// worker.js</span>
<span class="token function">postMessage</span><span class="token punctuation">(</span>aMessage<span class="token punctuation">,</span> transferList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><code>aMessage</code>는 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">structured clone 알고리즘</a>에 의해 복제될 수 있는 자바스크립트 객체라면 무엇이든 될 수 있습니다. 함수는 복제되지 않으며, 전송할 수 없습니다. 따라서 클래스를 전송해도 메서드는 전송되지 않습니다.</p>
<p>optional 파라미터인 <code>transferList</code>는 <code>ArrayBuffer</code>, <code>MessagePort</code>등의 transferable 객체를 배열로 전달합니다.</p>
<p><code>onmessage</code> 메서드는 상대방이 <code>postMessage</code>로 메세지를 전송했을 때의 이벤트 핸들러를 정의할 수 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// main thread</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
                        
<span class="token comment">// worker.js</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div>
<p>이벤트가 발생하면 핸들러에 <code>MessageEvent</code> 객체가 전달됩니다. <code>postMessage</code>로 전달한 데이터(<code>aMessage</code>)는 <code>data</code> 프로퍼티로 접근할 수 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// main thread</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token string">'web worker is fun!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// worker.js</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// web worker is fun!</span>
	<span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// main thread</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">onmessage</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yes</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>WorkerGlobalScope.importScripts()</h2>
<p>위에서 볼 수 있듯이, 웹 워커를 생성할 때 options의 type 프로퍼티를 <code>module</code>로 지정하여 ES6 module 문법을 사용할 수 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// main thread</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./worker.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'module'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// worker.js</span>
<span class="token keyword module">import</span> <span class="token imports">someUtil</span> <span class="token keyword module">from</span> <span class="token string">'../util'</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
</code></pre></div>
<p>하지만 사파리를 비롯한 많은 브라우저에서 지원하지 않기 때문에,  주의해서 사용해야 합니다.</p>
<p><img src="../assets/post-image/WebWorkers-API/es6module_browser_support.png" alt="image-20210409190614376"></p>
<p>그럼에도 외부 스크립트를 import해서 사용해야한다면, <code>importScripts</code> 메서드를 사용할 수 있습니다.
워커의 전역 맥락에 해당 스크립트를 동기적으로 불러와 사용할 수 있습니다.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// hello.js</span>
<span class="token keyword">function</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// worker.js</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'./hello.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello, john!</span>
</code></pre></div>
<p>주의할 점은, 해당 스크립트에 ES6 module 문법이 작성되어 있으면 <code>Uncaught DomException</code> 오류가 발생하여 실행되지 않습니다.</p>
</article></section></main><footer class="Footer__Container-qhytvz-0 eHAsYS"><div class="Footer__Content-qhytvz-1 bUsZOM"><a href="https://github.com/yes-xodnd" target="_blank" rel="noopener noreferrer "><i aria-hidden="true" class="fab fa-github"></i><span>yes-xodnd</span></a><div>ⓒ2021 ALL RIGHTS RESERVED</div></div></footer><button class="ButtonScrollUp__Button-sc-1ue24uv-0 iKWWFL"><img src="../../assets/icon/up.svg" alt="up" title="맨 위로"/></button></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"WebWorkers API","date":"2021-04-09T00:00:00.000Z","content":"\u003cp\u003e\u003ca href=\"https://yes-xodnd.github.io/js_benchmark\"\u003e자바스크립트 반복문 벤치마크 웹 어플리케이션\u003c/a\u003e을 만들면서, 연산 작업이 메인 스레드를 점유하고 애니메이션 업데이트 등 다른 작업을 막는 현상이 발생하였습니다.  \u003ca href=\"https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API\"\u003eWebWorkers API\u003c/a\u003e를 사용해 이를 해결할 수 있었고, 간단하게 웹 워커에 대해 정리해보았습니다.\u003c/p\u003e\n\u003ch3\u003e개요\u003c/h3\u003e\n\u003cp\u003e웹 워커는 메인 스레드와 분리된 백그라운드 스레드에서 스크립트 연산을 실행할 수 있도록 도와주는 Web API 입니다. 단일 스크립트에서만 사용하는 전용 워커(dedicated worker)와 여러 스크립트에서 공유할 수 있는 공유 워커(shared worker)가 있습니다.\u003c/p\u003e\n\u003ch3\u003e전역 맥락\u003c/h3\u003e\n\u003cp\u003e워커는 스크립트의 현재 전역 맥락(Window 객체)과 다른 전역 맥락에서 실행됩니다. 전용 워커, 공유워커의 전역 맥락은 각각 \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope\"\u003eDedicatedWorkerGlobalScope \u003c/a\u003e객체, \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope\"\u003eSharedWorkerGlobalScope\u003c/a\u003e 객체입니다.\u003c/p\u003e\n\u003cp\u003e대부분의 코드를 실행할 수 있지만, 다른 전역 맥락을 가지고 있기 때문에 일부 메서드의 실행은 제한됩니다. 대표적으로 DOM 조작이 불가능하며, DOM 트리에 접근해 조작하는 것 뿐 아니라 \u003ccode\u003edocument.createElement\u003c/code\u003e등으로 DOM 트리에 등록되지 않은 요소를 만드는 것도 불가능합니다.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Functions_and_classes_available_to_workers\"\u003eMDN 문서\u003c/a\u003e에서 워커가 사용할 수 있는 메서드를 확인할 수 있습니다.\u003c/p\u003e\n\u003ch3\u003e워커 생성\u003c/h3\u003e\n\u003cp\u003e워커는 window.Worker() 생성자를 통해 생성할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e worker \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWorker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaURL\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eaURL\u003c/code\u003e은 워커가 실행될 스크립트 파일의 URL로, 별도의 스크립트 전역 맥락(WorkerGlobalScope)를 가지게 됩니다. 일반적으로 파일에 접근하듯이 사용할 수도 있고, 현재 스크립트가 실행중인 도메인과 같은 도메인의 URL을 사용할 수도 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e worker1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWorker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./worker.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e worker2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWorker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'https://same-origin.com/somepath/worker.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eoptions\u003c/code\u003e를 이용해 워커의 설정을 변경할 수 있습니다. 사용 가능한 프로퍼티는 다음과 같습니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etype: \u003ccode\u003eclassic\u003c/code\u003e 또는 \u003ccode\u003emodule\u003c/code\u003e 로 지정됩니다. 기본값은 \u003ccode\u003eclassic\u003c/code\u003e이며, \u003ccode\u003emodule\u003c/code\u003e을 사용할 경우 워커 스크립트 파일에서 ES6 \u003ccode\u003eimport\u003c/code\u003e를 사용할 수 있습니다.\u003c/li\u003e\n\u003cli\u003ename: 전용 워커의 글로벌 스코프를 특정하는 이름을 지정합니다. 디버깅을 위해 사용됩니다.\u003c/li\u003e\n\u003cli\u003ecredentials: 워커를 사용하기 위해 필요한 자격 증명을 지정합니다. \u003ccode\u003eomit\u003c/code\u003e, \u003ccode\u003esame-origin\u003c/code\u003e, \u003ccode\u003einclude\u003c/code\u003e를 지정할 수 있습니다. \u003ccode\u003eclassic\u003c/code\u003e  type에서 기본값은 자격 증명이 필요없는 \u003ccode\u003eomit\u003c/code\u003e입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e워커 사용\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003epostMessage\u003c/code\u003e 메서드를 이용해 메인 스레드와 워커 스레드가 메세지를 전송하여 통신할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// main thread\u003c/span\u003e\nworker\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaMessage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e transferList\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// worker.js\u003c/span\u003e\n\u003cspan class=\"token function\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaMessage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e transferList\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eaMessage\u003c/code\u003e는 \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\"\u003estructured clone 알고리즘\u003c/a\u003e에 의해 복제될 수 있는 자바스크립트 객체라면 무엇이든 될 수 있습니다. 함수는 복제되지 않으며, 전송할 수 없습니다. 따라서 클래스를 전송해도 메서드는 전송되지 않습니다.\u003c/p\u003e\n\u003cp\u003eoptional 파라미터인 \u003ccode\u003etransferList\u003c/code\u003e는 \u003ccode\u003eArrayBuffer\u003c/code\u003e, \u003ccode\u003eMessagePort\u003c/code\u003e등의 transferable 객체를 배열로 전달합니다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eonmessage\u003c/code\u003e 메서드는 상대방이 \u003ccode\u003epostMessage\u003c/code\u003e로 메세지를 전송했을 때의 이벤트 핸들러를 정의할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// main thread\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e worker \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWorker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./worker.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nworker\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method-variable function-variable method function property-access\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ee\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n                        \n\u003cspan class=\"token comment\"\u003e// worker.js\u003c/span\u003e\n\u003cspan class=\"token function-variable function\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ee\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e이벤트가 발생하면 핸들러에 \u003ccode\u003eMessageEvent\u003c/code\u003e 객체가 전달됩니다. \u003ccode\u003epostMessage\u003c/code\u003e로 전달한 데이터(\u003ccode\u003eaMessage\u003c/code\u003e)는 \u003ccode\u003edata\u003c/code\u003e 프로퍼티로 접근할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// main thread\u003c/span\u003e\nworker\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'web worker is fun!'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// worker.js\u003c/span\u003e\n\u003cspan class=\"token function-variable function\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token parameter\"\u003ee\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003edata\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// web worker is fun!\u003c/span\u003e\n\t\u003cspan class=\"token function\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'yes'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// main thread\u003c/span\u003e\nworker\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eonmessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ee\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003edata\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// yes\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eWorkerGlobalScope.importScripts()\u003c/h2\u003e\n\u003cp\u003e위에서 볼 수 있듯이, 웹 워커를 생성할 때 options의 type 프로퍼티를 \u003ccode\u003emodule\u003c/code\u003e로 지정하여 ES6 module 문법을 사용할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// main thread\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e worker \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWorker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./worker.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'module'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// worker.js\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003esomeUtil\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'../util'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"token comment\"\u003e// ...\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e하지만 사파리를 비롯한 많은 브라우저에서 지원하지 않기 때문에,  주의해서 사용해야 합니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/post-image/WebWorkers-API/es6module_browser_support.png\" alt=\"image-20210409190614376\"\u003e\u003c/p\u003e\n\u003cp\u003e그럼에도 외부 스크립트를 import해서 사용해야한다면, \u003ccode\u003eimportScripts\u003c/code\u003e 메서드를 사용할 수 있습니다.\r\n워커의 전역 맥락에 해당 스크립트를 동기적으로 불러와 사용할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// hello.js\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003egreeting\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003ehello, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ename\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e!\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// worker.js\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eimportScripts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./hello.js'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003egreeting\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'john'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// hello, john!\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e주의할 점은, 해당 스크립트에 ES6 module 문법이 작성되어 있으면 \u003ccode\u003eUncaught DomException\u003c/code\u003e 오류가 발생하여 실행되지 않습니다.\u003c/p\u003e\n","slug":"WebWorkers-API"}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"WebWorkers-API"},"buildId":"1eHOgfUNySbG0mDrb1P6t","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/main-201f5cd97deb6faaf31b.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.e3de07479da4f2477dea.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.bf8cc4fd2753f92c2ca2.js" async=""></script><script src="/_next/static/chunks/2dd8024639213757075864c624e37c2da904a9c5.66371825a15182f8fdc5.js" async=""></script><script src="/_next/static/chunks/pages/_app-7f1cf177eb808772c597.js" async=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-07e92fca6c260976decf.js" async=""></script><script src="/_next/static/1eHOgfUNySbG0mDrb1P6t/_buildManifest.js" async=""></script><script src="/_next/static/1eHOgfUNySbG0mDrb1P6t/_ssgManifest.js" async=""></script></body></html>